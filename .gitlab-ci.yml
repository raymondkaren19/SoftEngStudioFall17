maven_build:
 stage: test
 image: maven:3.3.9-jdk-8
 script:
  - echo "Building project with maven"
  - mvn verify

deploy-to-staging:
 stage: deploy
 image: maven:3.3.9-jdk-8
 artifacts:
  paths:
   - target/*.war
 script:
  - echo "Deploy to staging server"
  - TOMCAT_HOST=$(ip route show | awk '/default/ {print $3}')
  - mvn package
  - curl -T "target/inventorymanager-webapp.war" "http://tomcat:${TOMCAT_PASSWORD}@${TOMCAT_HOST}:8888/manager/text/deploy?path=/inventorymanager-webapp&update=true"
 environment:
  name: staging
  url: http://ec2-52-87-247-183.compute-1.amazonaws.com:8888/inventorymanager-webapp/
 only:
  - master

deploy-to-production:
 stage: deploy
 image: maven:3.3.9-jdk-8
 artifacts:
  paths:
   - target/*.war
 script:
  - echo "Deploy to production server"
 environment:
  name: production
 only:
  - master
 when: manual
